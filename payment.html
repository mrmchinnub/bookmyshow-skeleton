<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment Page</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f0f0f0;
        margin: 0;
      }

      .payment-container {
        text-align: center;
        padding: 20px;
        border: 2px solid royalblue;
        border-radius: 10px;
        background-color: #fff;
      }

      h1 {
        color: royalblue;
      }

      p {
        font-size: 18px;
      }

      button {
        margin-top: 20px;
        padding: 10px 20px;
        background-color: royalblue;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="payment-container">
      <h1>Payment Page</h1>
      <div id="booking-summary">
        <h2>Booking Summary:</h2>
        <p id="selected-seats"></p>
        <p id="total-amount"></p>
      </div>

      <button id="confirm-booking">Confirm Booking</button>
      <button id="cancel-booking" onclick="backpage()">Cancel</button>
    </div>

    <script>
      //function for processing of cancel button
      function backpage() {
        const removeseats = JSON.parse(localStorage.getItem('seatNumbers'));
        const existingSelectedSeats =
          JSON.parse(localStorage.getItem('selectedSeats')) || [];

        const updateSelectedSeats = existingSelectedSeats.filter(
          (seat) => !removeseats.includes(seat),
        );

        // Update selectedSeats in local storage
        localStorage.setItem(
          'selectedSeats',
          JSON.stringify(updateSelectedSeats),
        );

        localStorage.removeItem('seatNumbers');

        window.location.assign('selectseat.html');
      }
      //Event for getting total seats and amount for selected seats
      document.addEventListener('DOMContentLoaded', function () {
        var selectedSeats = JSON.parse(localStorage.getItem('seatNumbers'));
        var selectedSeatsElement = document.getElementById('selected-seats');
        var totalAmountElement = document.getElementById('total-amount');
        if (selectedSeats.length > 0) {
          selectedSeatsElement.textContent =
            'Selected Seats: ' + selectedSeats.join(', ');
          console.log(localStorage.getItem('seatNumbers'));
        } else {
          selectedSeatsElement.textContent = 'No seats selected.';
        }
        //calculating the amount for slected seats
        var totalAmountElement = document.getElementById('total-amount');
        var totalAmount = calculateTotalAmount(selectedSeats);
        totalAmountElement.textContent = 'Total Amount: $' + totalAmount;
        //activation of confirm booking  button
        var confirmBookingButton = document.getElementById('confirm-booking');
        confirmBookingButton.addEventListener('click', function () {
          var seatNumbers = JSON.parse(localStorage.getItem('seatNumbers'));
          occupiedmark(seatNumbers);

          localStorage.setItem('bookingConfirmed', 'true');
          alert('Booking confirmed! Thank you for your reservation.');
          return window.location.assign('selectseat.html');
        });

        function calculateTotalAmount(selectedSeats) {
          return selectedSeats.length * 200;
        }

        function occupiedmark(seatNumbers) {
          var seatNumbers = JSON.parse(localStorage.getItem('seatNumbers'));
          console.log(seatNumbers);
          // Update the selected seats to indicate they are occupied
          seatNumbers.forEach((seatNumber) => {
            var seatElement = document.querySelector('.seat' + seatNumber);
            if (seatElement) {
              seatElement.classList.remove('seat-selected');
              seatElement.classList.toggle('seat-occupied');
              seatElement.style.backgroundColor = 'blueviolet';
            }
          });
          clearSelectedSeats();
        }
        function clearSelectedSeats() {
          selectedSeats = [];

          localStorage.removeItem('seatNumbers');
        }
      });
    </script>
  </body>
</html>
